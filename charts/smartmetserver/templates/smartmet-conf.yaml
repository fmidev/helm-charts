apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "smartmetserver.fullname" . }}-config
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "smartmetserver.labels.component" (dict "Chart" .Chart "Release" .Release "Values" .Values "component" "configuration") | nindent 4 }}
  annotations:
    meta.helm.sh/release-name: {{ .Release.Name }}
    meta.helm.sh/release-namespace: {{ .Release.Namespace }}
data:
  smartmet.conf: |
    // SmartMet Server Configuration
    // Generated by Helm Chart {{ .Chart.Name }}-{{ .Chart.Version }}
    
    // Bind to port
    port = {{ .Values.smartmetConf.server.port }};
    
    // Logging configuration
    defaultlogging = {{ .Values.smartmetConf.server.defaultlogging }};
    logrequests = {{ .Values.smartmetConf.server.logrequests }};
    verbose = {{ .Values.smartmetConf.server.verbose }};
    debug = {{ .Values.smartmetConf.server.debug }};
    
    // Performance settings
    lazylinking = {{ .Values.smartmetConf.server.lazylinking }};
    compress = {{ .Values.smartmetConf.server.compress }};
    compresslimit = {{ .Values.smartmetConf.server.compresslimit }};
    
    // Thread pool configuration
    slowpool:
    {
        maxthreads = {{ .Values.smartmetConf.pools.slowpool.maxthreads }};
        maxrequeuesize = {{ .Values.smartmetConf.pools.slowpool.maxrequeuesize }};
    };
    
    fastpool:
    {
        maxthreads = {{ .Values.smartmetConf.pools.fastpool.maxthreads }};
        maxrequeuesize = {{ .Values.smartmetConf.pools.fastpool.maxrequeuesize }};
    };
    
    // Engines configuration
    engines:
    {
        {{- range $engine := .Values.smartmetConf.engines }}
        {{ $engine }}:
        {
            configfile = "engines/{{ $engine }}.conf";
        };
        {{- end }}
    };
    
    // Plugins configuration
    plugins:
    {
        {{- range $plugin := .Values.smartmetConf.plugins }}
        {{ $plugin }}:
        {
            configfile = "plugins/{{ $plugin }}.conf";
        };
        {{- end }}
    };
